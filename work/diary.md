# 2023/01/26

AHC用マシンを起動して疎通確認。
前回はネットワークがつながらず本番中にもトラブルシューティングする羽目になったが今回は特に問題なく。

VScodeのupdateも特に走らず問題なく終了。

# 2023/01/27

「Psyhoさんによるヒューリスティック・ボットコンテストのための無料Tips
(https://ozy4dm.hateblo.jp/entry/2022/12/22/162046)
を読み返す。

# 2023/01/28

GitHubでレポジトリを作成。Privateが無料アカウントでも出来ることを知らなかった。
今までローカルレポジトリでやっていたがPCをまたぐと不便なので今回はGitHubに寄せる予定。

12時にスタート。昼ご飯を作りつつ問題文を眺める。

スケジュール問題風が日にちに依存する要素はないので辺集合の分割問題。

平面グラフというのがポイントか。
連結じゃなくなると不満度が10^9になってしまうのでまずは連結性をできるだけ保った分割を目指すことになりそう。

ぱっと思いつくのは平面グラフなので出来るだけ「遠い」辺を選べば連結性は保てそうということ。

テスト用に10000ケースをダウンロードして

・pre test: 50ケース
・sys test: 2000ケース
・stress test: 10000ケース

を作成。

Graphクラスを作成。工事する辺集合を決めるたびに全点でダイクストラをやっているのでここは要改善ポイント。

SqDistSchedulerを作成。
・距離はユークリッド距離の二乗
・未工事でまだ選らんでいない辺のうち、すでに選らだ辺との最小距離が最大
で選んでいく方法。


seed=7552が「平均より難し目」(N=764, M=1767, D=6, K=548)でテスト。

Graphクラスで距離の初期化を忘れていたりN(N-1)で割るのを忘れていたりしたが、Visualizerの結果と合った。

1辺だけ除いた場合のコスト増分をすべての辺に対して合計したものがコストの下界になるのでそれを求めるプログラムを作成。
1問当たり1分程度かかるため夜とかをうまく使う必要がある。

ダイクストラをBFSに変えたがほとんど変わらず。priority_queue内のノード数が多くならないからか。
夜にコスト下界をsys testで走らせて終了。

# 2023/01/29

コスト下界は2時間ほどで終了していた。

高速化のためにedge indexを持つようにしたらなぜかテストケースの結果が変わる…で少し悩むが
pre, sys, stressがそれぞれ包含されるようにはなっているが、先頭から並んでいるわけではないので
stressの先頭50件がpreになっているわけではなかったのが原因。

辺の集合をbitsetで持つようにして、辺削除時の最短路再計算を影響のあるノードについてのみ行うように変更。
11%高速化。

ここで初submit。平均73.5M。ちょっとコストは低めな印象。簡単な問題が集まっているのかもしれない。
この時点で相対スコア24Gくらいで111位。

辺(i, j)を削除した時の迂回路を出しておいて、工事計画を作るときに極力、迂回路を使わないことで非連結になるのを抑制するようにした。
sys test相当で平均コストが231Mから89Mに改善。

これをsubmitして平均コスト46.6M。
この時点で相対スコア25.6Gくらいで112位。コストを下げても相対スコアが上がらないというのは
非連結をなくすというのはトップ層は出来ていてて連結な上で経路増分の最小化勝負になっているということ。

迂回路回避は結果を可視化すると

・非連結なノードペア数の削減には貢献
・非連結の発生はあまり防げていない

になっている。

# アイディアメモ

## 最短路

* 距離がユークリッド距離で定義されているのでダイクストラではなくBFSで求まるはず(1/28)
  * 距離を10^3かけて四捨五入しているため厳密には三角不等式が成立しないがほぼ同じ答えがでるはず。
  ⇒同じ答えにはなったが速度はほぼ同じ。priority_queue内のノード数がそこまで多くならないからか。

## 辺集合を除去した場合の最短距離
辺集合を除いた場合の各点からの距離の総和を高速に求めたい。

* ノードごとに最短路木を持っておく
  * 削除する辺がその最短路木に含まれている場合にのみ最短路を再計算する

* 辺ごとに何回、最短路木に含まれているかを求めておき除くごとにう回路のコストから差分計算する(近似計算)

## 辺集合の選択

* 賢いGreedy(01/28)
  * 辺ごとに除いた場合のう回路を求めておく
  * う回路を除かないように辺を追加していく

* 焼きなまし法(01/28)
  * 日別の辺集合
  * 日は最初緩めにしておく？

* 円内を領域にわけてそこから選択する辺の数を焼きなます？(01/28)

* 平面グラフ(01/28)
  * 双対グラフを考えられる。面に対する操作を考える？

## ToDo
* Visualizer/Generatorのコードを読む
* CostLBをtest_stressで実行(10時間程度)